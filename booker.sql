
DROP TABLE USERIP;
CREATE TABLE USERIP(
	IP TEXT PRIMARY KEY NOT NULL,
	FOREIGN KEY(IP) REFERENCES RATE(IP)
);

DROP TABLE BOOKS;
CREATE TABLE BOOKS(
	BOOK_ID INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
	TITLE TEXT NOT NULL,
	SINOPSE TEXT,
	ISBN INT,
	IMG TEXT,
	LINKS TEXT,
	LIKES INT NOT NULL,
	DISLIKES INT NOT NULL,
	FOREIGN KEY(BOOK_ID) REFERENCES RATE(BOOK_ID)
);

DROP TABLE RATE;
CREATE TABLE RATE(
	IP TEXT NOT NULL,
	BOOK_ID INT NOT NULL,
	LOVE INT NOT NULL,
	HATE INT NOT NULL,
	FOREIGN KEY(IP) REFERENCES USERIP(IP),
	FOREIGN KEY(BOOK_ID) REFERENCES BOOKS(BOOK_ID)
);


INSERT INTO BOOKS(BOOK_ID,TITLE,SINOPSE,ISBN,IMG,LINKS,LIKES,DISLIKES)
VALUES(1,'Quim Barreiors','A vida de Quim',643272,'Img','link',5,7);

INSERT INTO BOOKS(BOOK_ID,TITLE,SINOPSE,ISBN,IMG,LINKS,LIKES,DISLIKES)
VALUES(2,'Ruca','A vida do careca',5434572,'Img','link',5,7);

INSERT INTO BOOKS(BOOK_ID,TITLE,SINOPSE,ISBN,IMG,LINKS,LIKES,DISLIKES)
VALUES(3,'ze e zeca','A vida dos zes',9934572,'Img','link',3,7);

.header on
.mode column

INSERT INTO USERIP(IP)
VALUES('192.168.10.10');

INSERT INTO USERIP(IP)
VALUES('193.168.10.10');

INSERT INTO USERIP(IP)
VALUES('196.168.10.10');

INSERT INTO USERIP(IP)
VALUES('192.115.10.10');



INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('192.168.10.10',1,1,0);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('193.168.10.10',1,1,0);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('196.168.10.10',1,1,0);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('192.115.10.10',1,1,0);


INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('192.168.10.10',2,1,0);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('193.168.10.10',2,1,0);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('196.168.10.10',2,0,1);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('192.115.10.10',2,1,0);


INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('192.168.10.10',3,0,1);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('193.168.10.10',3,0,1);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('196.168.10.10',3,1,0);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('192.115.10.10',3,1,0);


INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('192.168.10.10',4,1,0);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('193.168.10.10',4,1,0);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('196.168.10.10',4,1,0);

INSERT INTO RATE(IP,BOOK_ID,LOVE,HATE)
VALUES('192.115.10.10',4,1,0);

SELECT BOOKS.TITLE As 'Name', SUM(RATE.LOVE) As 'Me gusta', SUM(RATE.HATE) As 'NO!'
FROM RATE
JOIN BOOKS
ON BOOKS.BOOK_ID = RATE.BOOK_ID
GROUP BY BOOKS.BOOK_ID;

